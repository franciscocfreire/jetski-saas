{{ define "__alertmanager" }}AlertManager{{ end }}
{{ define "__alertmanagerURL" }}{{ .ExternalURL }}/#/alerts?receiver={{ .Receiver }}{{ end }}

{{ define "__subject" }}[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}{{ end }}

{{ define "__description" }}{{ end }}

{{ define "__text_alert_list" }}{{ range . }}
*Alert:* {{ .Annotations.summary }}{{ if .Labels.severity }} - `{{ .Labels.severity }}`{{ end }}

*Description:* {{ .Annotations.description }}

*Details:*
{{ range .Labels.SortedPairs }} â€¢ *{{ .Name }}:* `{{ .Value }}`
{{ end }}
{{ end }}{{ end }}

{{ define "slack.default.title" }}{{ template "__subject" . }}{{ end }}
{{ define "slack.default.username" }}{{ template "__alertmanager" . }}{{ end }}
{{ define "slack.default.fallback" }}{{ template "slack.default.title" . }} | {{ template "slack.default.titlelink" . }}{{ end }}
{{ define "slack.default.pretext" }}{{ end }}
{{ define "slack.default.titlelink" }}{{ template "__alertmanagerURL" . }}{{ end }}
{{ define "slack.default.iconemoji" }}{{ end }}
{{ define "slack.default.iconurl" }}{{ end }}
{{ define "slack.default.text" }}{{ end }}

{{ define "email.default.subject" }}{{ template "__subject" . }}{{ end }}
{{ define "email.default.html" }}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>{{ template "__subject" . }}</title>
  <style type="text/css">
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      color: #333;
    }
    .alert-status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 3px;
      font-weight: bold;
      text-transform: uppercase;
    }
    .alert-firing {
      background-color: #d9534f;
      color: white;
    }
    .alert-resolved {
      background-color: #5cb85c;
      color: white;
    }
    .alert-box {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      margin: 10px 0;
      background-color: #f9f9f9;
    }
    .critical { border-left: 4px solid #d9534f; }
    .warning { border-left: 4px solid #f0ad4e; }
    .info { border-left: 4px solid #5bc0de; }
  </style>
</head>
<body>
  <h2>
    <span class="alert-status alert-{{ .Status }}">{{ .Status | toUpper }}</span>
    {{ .GroupLabels.alertname }}
  </h2>

  <p><strong>Environment:</strong> {{ .CommonLabels.environment }}</p>
  <p><strong>Cluster:</strong> {{ .CommonLabels.cluster }}</p>

  {{ if gt (len .Alerts.Firing) 0 }}
  <h3>ðŸ”¥ Firing Alerts ({{ .Alerts.Firing | len }})</h3>
  {{ range .Alerts.Firing }}
  <div class="alert-box {{ .Labels.severity }}">
    <h4>{{ .Annotations.summary }}</h4>
    <p>{{ .Annotations.description }}</p>
    <p><strong>Severity:</strong> {{ .Labels.severity }}</p>
    <p><strong>Component:</strong> {{ .Labels.component }}</p>
    <p><strong>Started:</strong> {{ .StartsAt }}</p>

    <details>
      <summary>Labels</summary>
      <ul>
        {{ range .Labels.SortedPairs }}
        <li><strong>{{ .Name }}:</strong> {{ .Value }}</li>
        {{ end }}
      </ul>
    </details>
  </div>
  {{ end }}
  {{ end }}

  {{ if gt (len .Alerts.Resolved) 0 }}
  <h3>âœ… Resolved Alerts ({{ .Alerts.Resolved | len }})</h3>
  {{ range .Alerts.Resolved }}
  <div class="alert-box">
    <h4>{{ .Annotations.summary }}</h4>
    <p><strong>Duration:</strong> {{ .StartsAt }} - {{ .EndsAt }}</p>
  </div>
  {{ end }}
  {{ end }}

  <p style="margin-top: 20px;">
    <a href="{{ template "__alertmanagerURL" . }}">View in AlertManager</a>
  </p>
</body>
</html>
{{ end }}
